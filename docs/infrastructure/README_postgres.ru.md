# PostgreSQL

<p align="right">
  <a disabled href="README_postgres.ru.md">RU</a>
  <span>|</span>
  <a href="README_postgres.md">EN</a>
</p>

**Версия:** 18.2

База данных собиравется с скриптами инициализации. Эти скрипты исполняются **только если том еще не существует**.
Технически, это означает что все расширения, схемы, функции и триггеры будут инициализированы **только при самом первом билде** и никогда после этого (Пока том не будет физически удален).


### 0. [Скрипты Инициализации](../../infrastructure/postgres/init/00-init.sql)

 - `Maintenance` схема для всех кастомных функций.


### 1. [Дополнительные Расширения](../../infrastructure/postgres/init/01-extensions.sql)

 - `HypoPG`. Дополнительное расширение, позволяющее протестировать гипотетические индексы до их физического создания. (Расширение не включено в базовый образ PostgreSQL 18.2, поэтому скачивается дополнительно из [`Dockerfile`](../../infrastructure/postgres/Dockerfile))


 ### 2. [Функции](../../infrastructure/postgres/init/02-functions.sql)

 - `find_useless_indexes`. Эта функция анализирует:
    - сколько раз индекс был проверен
    - сколько строк индекс просмотрел
    - сколько данных затронул
    
    и возвращает базовую рекомендацию по индексу.
   
   **ОСТОРОЖНО:**  
   Не стоит слепо полагаться на эту функцию.
   Функция слишком комплексная и содержит большое количество условий.
   Не протестирована во всех возможных сценариях.

 - `find_duplicates_indexes`. Обнаруживает дублирующие индексы.

  | Метод | Имплементация |
  |--------|----------------|
  | Exact duplicates | ✅ Реализовано |
  | Left-side duplicates | ❌ Не реализовано |
  | Partial comparison | ❌❌❌ Ни слова о поиске схожести частичных индексов. |


### 3. [Триггеры](../../infrastructure/postgres/init/03-triggers.sql)

**Не реализовано**

> Забронировано для будущих обработчиков событий.  
> Все триггеры будут корректно задокументированы и реализованы с соблюдением архитектурной целостности проекта.